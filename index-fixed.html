<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Crafter v2.0 - Professional AI Personality Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(16px); background: rgba(255, 255, 255, 0.95); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .slider-container { position: relative; }
        .slider-value { position: absolute; right: 0; top: -20px; font-size: 12px; color: #666; }
        .personality-radar { max-width: 300px; margin: 0 auto; }
        .preset-card { transition: all 0.3s ease; cursor: pointer; }
        .preset-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1); }
        .budget-indicator { transition: all 0.3s ease; }
        .budget-indicator.warning { background-color: #fbbf24; }
        .budget-indicator.danger { background-color: #ef4444; }
        .facet-slider { margin: 8px 0; }
        .preview-panel { min-height: 400px; max-height: 400px; overflow-y: auto; }
        .chat-message { margin: 8px 0; padding: 12px; border-radius: 8px; }
        .chat-user { background: #3b82f6; color: white; margin-left: 20%; }
        .chat-agent { background: #f3f4f6; color: #374151; margin-right: 20%; }
        
        /* Custom Range Sliders */
        .range-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            margin: 10px 0;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .range-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Tab styles */
        .tab-button {
            padding: 12px 24px;
            border-radius: 8px 8px 0 0;
            border: 1px solid #e5e7eb;
            border-bottom: none;
            background: #f9fafb;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: white;
            color: #3b82f6;
            border-color: #3b82f6 #3b82f6 white #3b82f6;
            z-index: 1;
            position: relative;
        }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .chat-user, .chat-agent { margin: 8px 0; }
            .personality-radar { max-width: 250px; }
        }

        /* Loading indicator */
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold">üß† Agent Crafter v2.0</h1>
                    <p class="text-blue-100 mt-2">Professional AI Personality Builder</p>
                </div>
                <div class="text-right">
                    <div id="budgetContainer" class="budget-indicator bg-green-500 text-white px-4 py-2 rounded-lg">
                        <div class="text-sm">Personality Budget</div>
                        <div id="budgetDisplay" class="text-xl font-bold">500 / 500</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-7xl mx-auto">
            <!-- Status/Debug Panel -->
            <div id="debugPanel" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
                <h3 class="text-yellow-800 font-semibold">Debug Info</h3>
                <div id="debugInfo" class="text-sm text-yellow-700 mt-2"></div>
            </div>

            <!-- Tab Navigation -->
            <div class="flex flex-wrap border-b border-gray-200 mb-6" id="tabNavigation">
                <button class="tab-button active" onclick="switchTab('core')">
                    üß† Core Personality
                </button>
                <button class="tab-button" onclick="switchTab('communication')">
                    üí¨ Communication
                </button>
                <button class="tab-button" onclick="switchTab('expertise')">
                    üíº Expertise
                </button>
                <button class="tab-button" onclick="switchTab('behavioral')">
                    üéØ Behavioral
                </button>
                <button class="tab-button" onclick="switchTab('advanced')">
                    ‚öôÔ∏è Advanced
                </button>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Main Configuration Panel -->
                <div class="lg:col-span-2">
                    <!-- Tab 1: Core Personality -->
                    <div id="tab-core" class="tab-content active">
                        <div class="bg-white rounded-xl shadow-lg p-8 glass-effect">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üß† Core Personality (Big 5)</h2>
                            
                            <div class="space-y-8">
                                <!-- Extraversion -->
                                <div class="personality-trait">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">Extraversion</h3>
                                        <span id="extraversion-value" class="text-blue-600 font-bold">50</span>
                                    </div>
                                    <input type="range" id="extraversion" class="range-slider" min="0" max="100" value="50">
                                </div>

                                <!-- Agreeableness -->
                                <div class="personality-trait">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">Agreeableness</h3>
                                        <span id="agreeableness-value" class="text-green-600 font-bold">50</span>
                                    </div>
                                    <input type="range" id="agreeableness" class="range-slider" min="0" max="100" value="50">
                                </div>

                                <!-- Conscientiousness -->
                                <div class="personality-trait">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">Conscientiousness</h3>
                                        <span id="conscientiousness-value" class="text-purple-600 font-bold">50</span>
                                    </div>
                                    <input type="range" id="conscientiousness" class="range-slider" min="0" max="100" value="50">
                                </div>

                                <!-- Emotional Stability -->
                                <div class="personality-trait">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">Emotional Stability</h3>
                                        <span id="emotional-stability-value" class="text-red-600 font-bold">50</span>
                                    </div>
                                    <input type="range" id="emotional-stability" class="range-slider" min="0" max="100" value="50">
                                </div>

                                <!-- Openness -->
                                <div class="personality-trait">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">Openness to Experience</h3>
                                        <span id="openness-value" class="text-orange-600 font-bold">50</span>
                                    </div>
                                    <input type="range" id="openness" class="range-slider" min="0" max="100" value="50">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other tabs placeholder -->
                    <div id="tab-communication" class="tab-content">
                        <div class="bg-white rounded-xl shadow-lg p-8 glass-effect">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üí¨ Communication Style</h2>
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üöß</div>
                                <p class="text-gray-500">Tab available - Implementation in progress...</p>
                            </div>
                        </div>
                    </div>

                    <div id="tab-expertise" class="tab-content">
                        <div class="bg-white rounded-xl shadow-lg p-8 glass-effect">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üíº Professional Expertise</h2>
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üöß</div>
                                <p class="text-gray-500">Tab available - Implementation in progress...</p>
                            </div>
                        </div>
                    </div>

                    <div id="tab-behavioral" class="tab-content">
                        <div class="bg-white rounded-xl shadow-lg p-8 glass-effect">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">üéØ Behavioral Patterns</h2>
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üöß</div>
                                <p class="text-gray-500">Tab available - Implementation in progress...</p>
                            </div>
                        </div>
                    </div>

                    <div id="tab-advanced" class="tab-content">
                        <div class="bg-white rounded-xl shadow-lg p-8 glass-effect">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è Advanced Configuration</h2>
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üöß</div>
                                <p class="text-gray-500">Tab available - Implementation in progress...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar: Live Preview -->
                <div class="lg:col-span-1">
                    <div class="sticky top-8 space-y-6">
                        <!-- Personality Radar -->
                        <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Personality Radar</h3>
                            <div class="personality-radar">
                                <canvas id="personalityChart"></canvas>
                            </div>
                        </div>

                        <!-- Live Preview Chat -->
                        <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">üí¨ Live Preview</h3>
                            <div class="preview-panel" id="previewPanel">
                                <div class="chat-message chat-user">
                                    Bonjour ! Peux-tu te pr√©senter ?
                                </div>
                                <div class="chat-message chat-agent">
                                    <span id="previewResponse">Bonjour ! Je suis votre assistant IA. Ma personnalit√© s'adapte selon votre configuration...</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button onclick="generatePreview()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-all">
                                    üîÑ R√©g√©n√©rer Preview
                                </button>
                            </div>
                        </div>

                        <!-- Quick Presets -->
                        <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">‚ö° Quick Presets</h3>
                            <div class="space-y-2">
                                <button onclick="loadPreset('supportAgent')" class="preset-card w-full p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500">
                                    <div class="font-medium">üéß Support Agent</div>
                                    <div class="text-sm text-gray-500">Patient & helpful</div>
                                </button>
                                <button onclick="loadPreset('creativePartner')" class="preset-card w-full p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500">
                                    <div class="font-medium">üé® Creative Partner</div>
                                    <div class="text-sm text-gray-500">Innovative & inspiring</div>
                                </button>
                                <button onclick="loadPreset('dataAnalyst')" class="preset-card w-full p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500">
                                    <div class="font-medium">üìä Data Analyst</div>
                                    <div class="text-sm text-gray-500">Analytical & precise</div>
                                </button>
                            </div>
                        </div>

                        <!-- Debug Panel Toggle -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <button onclick="toggleDebug()" class="w-full text-sm text-gray-600 hover:text-gray-800">
                                üîß Toggle Debug Info
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-8 flex justify-center space-x-4">
                <button onclick="resetAll()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-medium transition-all">
                    üîÑ Reset All
                </button>
                <button onclick="exportAgent()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-medium transition-all">
                    üíæ Export Agent
                </button>
                <button onclick="testAgent()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-lg font-medium transition-all">
                    üß™ Advanced Test
                </button>
            </div>
        </div>
    </div>

    <script>
        console.log('üß† Agent Crafter v2.0 - Starting initialization...');
        
        // Global state with error handling
        let personalityData = {
            core: {
                extraversion: 50,
                agreeableness: 50, 
                conscientiousness: 50,
                emotionalStability: 50,
                openness: 50
            },
            communication: {
                primaryStyle: 'friendly',
                modifiers: [],
                verbosity: 5,
                structure: 'paragraphs',
                tones: {
                    optimism: 50,
                    formality: 50,
                    patience: 50,
                    confidence: 50
                }
            },
            expertise: {
                level: 'competent',
                roleArchetype: 'mentor',
                industries: [],
                thinkingStyles: [],
                problemSolving: {
                    speedThoroughness: 50,
                    riskCaution: 50,
                    independentCollaborative: 50
                },
                learningApproach: []
            },
            behavioral: {
                proactivity: 50,
                questioningStyle: 'clarifying',
                errorHandling: [],
                responseBehavior: {
                    followup: 50,
                    elaboration: 50,
                    context: 50,
                    examples: 50
                },
                languageStyle: 'global',
                culturalSensitivity: 50,
                adaptationBehavior: [],
                interactionPatterns: []
            },
            advanced: {
                technicalCapabilities: [],
                maxResponseLength: 'medium',
                securityLevel: 'standard',
                contentFilters: ['adult-content', 'violence', 'hate-speech'],
                systemInstructions: '',
                userInstructions: '',
                fallbackResponses: '',
                conditionalBehaviors: [],
                timeBehaviors: [],
                preferredModel: 'auto',
                responseFormat: 'adaptive',
                temperature: 0.7,
                timeout: 30
            },
            budget: { used: 250, total: 500 },
            initialized: false
        };

        let personalityChart = null;
        let debugMode = false;

        // Safe element access function
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`‚ö†Ô∏è Element not found: ${id}`);
                return null;
            }
            return element;
        }

        // Safe element update function
        function safeUpdateElement(id, value) {
            const element = safeGetElement(id);
            if (element) {
                element.textContent = value;
                return true;
            }
            return false;
        }

        // Debug functions
        function toggleDebug() {
            debugMode = !debugMode;
            const debugPanel = safeGetElement('debugPanel');
            if (debugPanel) {
                debugPanel.classList.toggle('hidden', !debugMode);
                if (debugMode) {
                    updateDebugInfo();
                }
            }
        }

        function updateDebugInfo() {
            if (!debugMode) return;
            
            const debugInfo = safeGetElement('debugInfo');
            if (debugInfo) {
                debugInfo.innerHTML = `
                    <strong>Personality Data State:</strong><br>
                    ‚Ä¢ Core traits sum: ${Object.values(personalityData.core).reduce((a, b) => a + b, 0)}<br>
                    ‚Ä¢ Budget used: ${personalityData.budget.used}/${personalityData.budget.total}<br>
                    ‚Ä¢ Chart initialized: ${personalityChart !== null}<br>
                    ‚Ä¢ Primary style: ${personalityData.communication.primaryStyle}<br>
                    ‚Ä¢ Expertise level: ${personalityData.expertise.level}<br>
                    ‚Ä¢ Last update: ${new Date().toLocaleTimeString()}
                `;
            }
        }

        // Tab switching with error handling
        function switchTab(tabName) {
            try {
                console.log(`üîÑ Switching to tab: ${tabName}`);
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Show selected tab
                const targetTab = safeGetElement(`tab-${tabName}`);
                if (targetTab) {
                    targetTab.classList.add('active');
                } else {
                    console.error(`‚ùå Tab not found: tab-${tabName}`);
                    return;
                }
                
                // Update active button
                event.target.classList.add('active');
                
                console.log(`‚úÖ Tab switched to: ${tabName}`);
            } catch (error) {
                console.error('‚ùå Error switching tab:', error);
            }
        }

        // Initialize personality radar chart with error handling
        function initPersonalityChart() {
            try {
                console.log('üìä Initializing personality chart...');
                
                const ctx = safeGetElement('personalityChart');
                if (!ctx) {
                    console.error('‚ùå Canvas element not found for chart');
                    return;
                }
                
                const canvasCtx = ctx.getContext('2d');
                if (!canvasCtx) {
                    console.error('‚ùå Could not get canvas 2D context');
                    return;
                }
                
                personalityChart = new Chart(canvasCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Extraversion', 'Agreeableness', 'Conscientiousness', 'Emotional Stability', 'Openness'],
                        datasets: [{
                            label: 'Personality Profile',
                            data: [50, 50, 50, 50, 50],
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(59, 130, 246, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Personality chart initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing chart:', error);
                const chartContainer = safeGetElement('personalityChart');
                if (chartContainer && chartContainer.parentElement) {
                    chartContainer.parentElement.innerHTML = '<div class="text-red-500 text-center">Chart initialization failed</div>';
                }
            }
        }

        // Update personality values with error handling
        function updatePersonalityValue(trait, value) {
            try {
                personalityData.core[trait] = parseInt(value);
                safeUpdateElement(`${trait}-value`, value);
                updatePersonalityChart();
                updateBudget();
                generatePreview();
                
                if (debugMode) {
                    updateDebugInfo();
                }
                
                console.log(`‚úÖ Updated ${trait} to ${value}`);
            } catch (error) {
                console.error('‚ùå Error updating personality value:', error);
            }
        }

        // Update radar chart with error handling
        function updatePersonalityChart() {
            try {
                if (personalityChart && personalityChart.data && personalityChart.data.datasets[0]) {
                    personalityChart.data.datasets[0].data = [
                        personalityData.core.extraversion || 50,
                        personalityData.core.agreeableness || 50,
                        personalityData.core.conscientiousness || 50,
                        personalityData.core.emotionalStability || 50,
                        personalityData.core.openness || 50
                    ];
                    personalityChart.update('none'); // Disable animation for performance
                }
            } catch (error) {
                console.error('‚ùå Error updating chart:', error);
            }
        }

        // Budget system with error handling
        function updateBudget() {
            try {
                const sum = Object.values(personalityData.core).reduce((a, b) => a + b, 0);
                personalityData.budget.used = sum;
                
                const display = safeGetElement('budgetDisplay');
                const indicator = safeGetElement('budgetContainer');
                
                if (display) {
                    display.textContent = `${sum} / ${personalityData.budget.total}`;
                }
                
                if (indicator) {
                    // Reset classes
                    indicator.className = 'budget-indicator text-white px-4 py-2 rounded-lg ';
                    
                    // Update budget indicator color
                    if (sum > personalityData.budget.total * 0.9) {
                        indicator.classList.add('bg-red-500');
                    } else if (sum > personalityData.budget.total * 0.8) {
                        indicator.classList.add('bg-yellow-500');
                    } else {
                        indicator.classList.add('bg-green-500');
                    }
                }
            } catch (error) {
                console.error('‚ùå Error updating budget:', error);
            }
        }

        // Generate live preview with comprehensive error handling
        function generatePreview() {
            try {
                console.log('üîÑ Generating preview...');
                
                const traits = personalityData.core || {};
                const comm = personalityData.communication || {};
                const exp = personalityData.expertise || {};
                const behav = personalityData.behavioral || {};
                
                let response = "Bonjour ! ";

                // Communication style influence
                const greetings = {
                    professional: "Bonjour. ",
                    friendly: "Salut ! ",
                    academic: "Bonjour, permettez-moi de me pr√©senter. ",
                    creative: "Hey ! Enchant√© de vous rencontrer ! ",
                    technical: "Bonjour. Initialisation du syst√®me de communication. ",
                    coaching: "Salut ! C'est parti pour cette nouvelle interaction ! ",
                    therapeutic: "Bonjour, je suis l√† pour vous accompagner. ",
                    enthusiastic: "Bonjour ! Super de vous rencontrer ! "
                };
                
                response = greetings[comm.primaryStyle] || "Bonjour ! ";

                // Expertise level influence
                const expertisePresentations = {
                    novice: "Je suis encore en apprentissage et j'aime poser des questions pour mieux comprendre. ",
                    competent: "J'ai des connaissances solides et fiables dans mes domaines d'expertise. ",
                    proficient: "Je poss√®de une exp√©rience approfondie et une compr√©hension nuanc√©e. ",
                    expert: "Je ma√Ætrise profond√©ment mes domaines et j'aime partager mes connaissances. ",
                    master: "J'apporte une vision innovante et visionnaire √† mes domaines d'expertise. "
                };
                
                if (exp.level && expertisePresentations[exp.level]) {
                    response += expertisePresentations[exp.level];
                }

                // Personality influence
                if (traits.extraversion > 70) {
                    response += "Je suis tr√®s sociable et j'adore √©changer ! ";
                } else if (traits.extraversion < 30) {
                    response += "J'ai un style plut√¥t r√©serv√© et r√©fl√©chi. ";
                }

                if (traits.agreeableness > 70) {
                    response += "Je suis tr√®s bienveillant et coop√©ratif. ";
                } else if (traits.agreeableness < 30) {
                    response += "J'ai tendance √† √™tre direct et factuel. ";
                }

                if (traits.openness > 70) {
                    response += "J'adore explorer de nouvelles id√©es cr√©atives ! ";
                } else if (traits.openness < 30) {
                    response += "Je privil√©gie les approches pratiques et √©prouv√©es. ";
                }

                // Behavioral influence
                if (behav.proactivity > 70) {
                    response += "Je serai proactif en anticipant vos besoins. ";
                }

                // Final message
                response += "Comment puis-je vous assister aujourd'hui ?";

                // Update preview safely
                const success = safeUpdateElement('previewResponse', response);
                if (success) {
                    console.log('‚úÖ Preview updated successfully');
                } else {
                    console.warn('‚ö†Ô∏è Could not update preview element');
                }
                
            } catch (error) {
                console.error('‚ùå Error generating preview:', error);
                safeUpdateElement('previewResponse', 'Erreur lors de la g√©n√©ration du preview. Veuillez r√©essayer.');
            }
        }

        // Preset loading with error handling
        function loadPreset(presetName) {
            try {
                console.log(`üéØ Loading preset: ${presetName}`);
                
                const presets = {
                    supportAgent: {
                        extraversion: 65,
                        agreeableness: 85,
                        conscientiousness: 80,
                        emotionalStability: 90,
                        openness: 40
                    },
                    creativePartner: {
                        extraversion: 75,
                        agreeableness: 70,
                        conscientiousness: 45,
                        emotionalStability: 60,
                        openness: 95
                    },
                    dataAnalyst: {
                        extraversion: 40,
                        agreeableness: 55,
                        conscientiousness: 95,
                        emotionalStability: 80,
                        openness: 70
                    }
                };

                const preset = presets[presetName];
                if (preset) {
                    Object.keys(preset).forEach(trait => {
                        const slider = safeGetElement(trait);
                        if (slider) {
                            slider.value = preset[trait];
                            updatePersonalityValue(trait, preset[trait]);
                        }
                    });
                    console.log(`‚úÖ Preset ${presetName} loaded successfully`);
                } else {
                    console.error(`‚ùå Preset not found: ${presetName}`);
                }
            } catch (error) {
                console.error('‚ùå Error loading preset:', error);
            }
        }

        // Reset all values with confirmation
        function resetAll() {
            try {
                if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir r√©initialiser tous les param√®tres ?')) {
                    console.log('üîÑ Resetting all values...');
                    
                    Object.keys(personalityData.core).forEach(trait => {
                        const slider = safeGetElement(trait);
                        if (slider) {
                            slider.value = 50;
                            updatePersonalityValue(trait, 50);
                        }
                    });
                    
                    console.log('‚úÖ All values reset successfully');
                }
            } catch (error) {
                console.error('‚ùå Error resetting values:', error);
            }
        }

        // Export agent configuration
        function exportAgent() {
            try {
                console.log('üíæ Exporting agent configuration...');
                
                const agentConfig = {
                    version: "2.0",
                    metadata: {
                        name: "Custom Agent",
                        description: "AI Agent created with Agent Crafter v2.0",
                        createdAt: new Date().toISOString(),
                        budgetUsed: personalityData.budget.used
                    },
                    core: personalityData.core,
                    communication: personalityData.communication,
                    expertise: personalityData.expertise,
                    behavioral: personalityData.behavioral,
                    advanced: personalityData.advanced
                };

                const blob = new Blob([JSON.stringify(agentConfig, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'agent-crafter-v2-config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('‚úÖ Agent configuration exported successfully');
            } catch (error) {
                console.error('‚ùå Error exporting agent:', error);
                alert('‚ùå Erreur lors de l\'export. Veuillez r√©essayer.');
            }
        }

        // Advanced test placeholder
        function testAgent() {
            try {
                alert('üß™ Advanced Testing - Coming Soon!\n\nCette fonctionnalit√© permettra de tester votre agent dans diff√©rents sc√©narios.');
            } catch (error) {
                console.error('‚ùå Error in test function:', error);
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('üöÄ DOM loaded, initializing Agent Crafter v2.0...');
                
                // Initialize chart
                initPersonalityChart();
                
                // Update budget
                updateBudget();
                
                // Generate initial preview
                generatePreview();

                // Add event listeners for personality sliders with error handling
                Object.keys(personalityData.core).forEach(trait => {
                    const slider = safeGetElement(trait);
                    if (slider) {
                        slider.addEventListener('input', function() {
                            updatePersonalityValue(trait, parseInt(this.value));
                        });
                        console.log(`‚úÖ Event listener added for ${trait}`);
                    } else {
                        console.warn(`‚ö†Ô∏è Slider not found for ${trait}`);
                    }
                });

                // Mark as initialized
                personalityData.initialized = true;
                
                console.log('‚úÖ Agent Crafter v2.0 initialized successfully!');
                
                // Show success message
                setTimeout(() => {
                    if (debugMode) {
                        updateDebugInfo();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Critical error during initialization:', error);
                alert('‚ùå Erreur critique lors de l\'initialisation. Veuillez recharger la page.');
            }
        });

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('üî• Global error caught:', event.error);
            if (debugMode) {
                const debugInfo = safeGetElement('debugInfo');
                if (debugInfo) {
                    debugInfo.innerHTML += `<br><strong style="color: red;">Error:</strong> ${event.error.message}`;
                }
            }
        });

        console.log('üß† Agent Crafter v2.0 script loaded successfully!');
    </script>
</body>
</html>